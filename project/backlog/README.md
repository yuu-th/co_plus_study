# バックログ管理

## 概要

このディレクトリでタスク（Issue相当）を管理します。
**タスクファイル = AIエージェントへのプロンプト** として機能します。

---

## 2つの起動方法

### 方法1: オーケストレーターに依頼（推奨）

**大きな機能や複数タスクがある場合**

1. `.prompts/orchestrator.md` をAIに渡す
2. 実装したい機能を依頼
3. オーケストレーターがタスクを分解し、`todo/` にファイルを生成
4. 生成されたタスクをサブエージェントに渡して実行

### 方法2: todoファイルを直接渡す

**単発タスクの場合**

1. `.prompts/subagent.md` + `todo/` 内のタスクファイルをAIに渡す
2. AIがタスクを実行

---

## ディレクトリ

| ディレクトリ | 説明 | 制限 |
|-------------|------|------|
| `todo/` | 未着手タスク（実行可能なプロンプト） | なし |
| `doing/` | 進行中タスク | **最大3個** |
| `done/` | 完了タスク | 削除しない |

---

## タスクファイルのフォーマット

**重要**: タスクファイルは「サブエージェントへの完全な指示書」です。

### 必須構造

```markdown
---
id: {feature}-{task-name}
feature: {feature-name}
depends_on: [{dependency-ids}]
scope_files:
  - {編集対象ファイル}
forbidden_files:
  - {触ってはいけないパターン}
created_at: {YYYY-MM-DD}
---

# タスク: {タスクタイトル}

## 0. 最初に必ず読むファイル（スキップ禁止）
## 1. タスク概要
## 2. 完了条件
## 3. 編集対象ファイル
## 4. 参考にすべき既存実装
## 5. 技術的制約
## 6. 実装のヒント
## 7. 作業完了時の報告
## 8. 失敗した場合
```

---

## 実行可能判定

タスクは以下の条件を満たすとき **実行可能** です：

1. `todo/` に存在する
2. `depends_on` が空、**または**
3. `depends_on` に記載された全タスクが `done/` に移動済み

**例:**
```
todo/mentor-types.md    depends_on: []           → 実行可能
todo/mentor-mock.md     depends_on: [mentor-types]
todo/mentor-card.md     depends_on: [mentor-types]

# mentor-types が done/ に移動したら:
todo/mentor-mock.md     depends_on: [mentor-types] → 実行可能
todo/mentor-card.md     depends_on: [mentor-types] → 実行可能
```

---

## ワークフロー

### オーケストレーター経由の場合

```
ユーザー依頼
    ↓
┌─────────────────────────────────────┐
│ .prompts/orchestrator.md をAIに渡す │
│ → タスク分解・依存関係特定          │
│ → todo/ にタスクファイル生成        │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ 実行可能タスクを doing/ に移動      │
│ → .prompts/subagent.md + タスクを   │
│   サブAIに渡す                      │
│ → サブAIが実行・報告                │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ 完了タスクを done/ に移動           │
│ → 新たに実行可能になったタスクを確認│
│ → 繰り返す...                       │
└─────────────────────────────────────┘
```

### 手動タスク管理の場合

```
1. タスク作成
   → todo/ にファイル作成（テンプレート使用）

2. 着手
   → 実行可能なタスク（depends_on 解決済み）を doing/ に移動
   → doing/ は最大3個まで（WIP制限）

3. 実行
   → タスクファイルをAIに渡す
   → AIが実行・報告

4. 完了
   → done/ に移動
   → 新たに実行可能になるタスクを確認
```

---

## 命名規則

```
{feature}-{task-name}.md

例:
mentor-types.md      # mentor機能, 型定義
mentor-card.md       # mentor機能, カード
mentor-mock.md       # mentor機能, モックデータ
mentor-page.md       # mentor機能, ページ
```

---

## サブエージェントへの注意

サブエージェント（タスク実行AI）は以下を守る：

1. **タスクファイルだけを見て作業する**（オーケストレーターの存在を知らない）
2. **必読ファイルを必ず読む**（スキップ禁止）
3. **編集対象ファイルだけを触る**（それ以外は禁止）
4. **完了報告を必ず行う**

---

## 関連ファイル

| ファイル | 用途 |
|----------|------|
| `.prompts/orchestrator.md` | オーケストレーターへの指示書 |
| `.prompts/subagent.md` | サブエージェントへの指示書 |
| `specs/overview.md` | システム全体像（全タスク共通の必読） |
| `specs/shared/conventions.md` | コーディング規約（全タスク共通の必読） |
