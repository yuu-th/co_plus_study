---
id: design-spec-chat-improvements
feature: chat
depends_on: []
scope_files:
  - specs/features/chat.md
forbidden_files:
  - frontend/src/
  - project/backlog/
created_at: 2025-11-27
---

# タスク: 相談チャット機能仕様書更新

> このファイルはサブエージェントへの作業指示書です。

## 0. 最初に必ず読むファイル（スキップ禁止）

| 順序 | ファイル | 読む目的 |
|------|----------|----------|
| 1 | `specs/overview.md` | システム全体像・技術制約 |
| 2 | `specs/features/chat.md` | 既存仕様 |
| 3 | `specs/shared/conventions.md` | コーディング規約 |

## 1. タスク概要

相談チャット機能の仕様書を更新する。ユーザーフィードバックをもとに、UI/UX改善と新機能を仕様に反映する。

## 2. 完了条件

- [ ] `specs/features/chat.md` が更新されている
- [ ] 以下の改善が反映されている：
  - [ ] 「メンター」表記の見直し（より親しみやすい表現へ）
  - [ ] 自分/相手メッセージの識別性向上（色、アイコン、位置レイアウト）
  - [ ] 画像送信機能の仕様追加
  - [ ] LINEスタイルリアクション（絵文字リアクション）機能
- [ ] 矛盾がないこと

## 3. 編集対象ファイル

| ファイル | 操作 |
|----------|------|
| `specs/features/chat.md` | 編集 |

## 4. 具体的な改善内容

### 4.1 表現の見直し
現在の表現:
- 「メンター」「生徒」などの固い表現

改善後:
- より親しみやすい呼称を検討
- ただしシステム内部では統一（提案: 「おにいさん/おねえさん」または「先生」等、小中学生向けの表現）

### 4.2 メッセージの識別性
現在:
- 自分: 右寄せ、緑背景
- 相手: 左寄せ、グレー背景

改善後:
- アイコンの配置（自分/相手で異なる側に配置）
- 色の強調度調整
- 名前/日時表示の位置の最適化

### 4.3 データ構造の拡張
Message型に以下を追加:

| フィールド | 型 | 説明 |
|-----------|-----|------|
| type | 'text' \| 'image' | メッセージタイプ |
| imageUrl | string \| null | 画像URL（type='image'時） |
| reactions | MessageReaction[] | リアクション配列（新規） |

MessageReaction型:
```typescript
type MessageReaction = {
  emoji: string;      // 👍 ❤️ など
  userIds: string[];  // リアクション者ID
};
```

### 4.4 画像送信機能
- ファイルアップロードボタン
- 画像プレビュー表示
- 最大サイズ制限（仕様値: 5MB等、合意値を記載）

### 4.5 リアクション機能
- メッセージ上でホバー時に絵文字リアクションボタン表示
- LINE風のリアクション選択肢: 👍 ❤️ 🎉 👏 🔥 （既存の diary.reactions と統一）

### 4.6 チャットルーム情報
ChatRoom型に以下を追加:

| フィールド | 型 | 説明 |
|-----------|-----|------|
| studentName | string | 生徒の表示名 |
| studentAvatar | string \| null | 生徒のアバター |

## 5. 変更履歴セクション

既存の変更履歴を保持し、新しいエントリを追加:

```
| 2025-11-27 | UI/UX改善: 表現見直し、識別性向上、画像送信、リアクション機能追加 |
```

## 6. 注意事項

- 型定義（`types/chat.ts`）は後続タスクで更新
- 実装コンポーネント更新は別タスク
- 仕様のみ最新化

## 7. 完了報告

```markdown
## 完了報告

### タスクID
design-spec-chat-improvements

### 編集ファイル
- `specs/features/chat.md` - 更新

### 主要な変更点
- メッセージ識別性向上（アイコン、色、位置）
- 画像送信機能の仕様追加
- LINEスタイルリアクション機能の仕様追加
- チャットルームに学生情報を追加

### 未解決の問題
- なし
```
