# 並列エージェント タスク分配プロンプト生成器

> **このファイルの使い方**: 
> 1. このプロンプト全体をAI（オーケストレーター）に渡す
> 2. 実行したいタスクの概要を伝える
> 3. AIが各エージェント用のプロンプトを生成する

---

## 0. オーケストレーターの初期化（最初に必ず実行）

**あなたがタスク分配を行う前に、以下の手順でコンテキストを取得してください。**
**この手順をスキップすると、不正確なタスク分配になります。**

### 0.1 必読ファイル（この順序で読むこと）

| 順序 | ファイル | 読む目的 | 抽出すべき情報 |
|------|----------|----------|----------------|
| 1 | `specs/overview.md` | システム全体像の把握 | 対象ユーザー、機能一覧、技術制約、禁止事項 |
| 2 | `specs/shared/conventions.md` | コーディング規約の把握 | 命名規則、ファイル構成、禁止事項 |
| 3 | `specs/features/*.md` | 関連機能の仕様把握 | データ構造、コンポーネント、画面仕様 |
| 4 | `project/backlog/todo/` | 未着手タスクの確認 | 既存のタスク定義、優先度 |
| 5 | `project/backlog/doing/` | 進行中タスクの確認 | 衝突の可能性があるタスク |

### 0.2 既存実装の確認（タスクに関連する場合）

| 順序 | ディレクトリ | 確認目的 |
|------|-------------|----------|
| 6 | `frontend/src/types/` | 既存の型定義を把握 |
| 7 | `frontend/src/components/` | 類似コンポーネントの実装パターンを把握 |
| 8 | `frontend/src/pages/` | ページ構成を把握 |
| 9 | `frontend/src/mockData/` | 既存のモックデータ形式を把握 |

### 0.3 コンテキスト取得の確認チェックリスト

タスク分配を開始する前に、以下を確認してください：

- [ ] overview.md から技術スタック・禁止事項を理解した
- [ ] conventions.md から命名規則を理解した
- [ ] 関連する features/*.md の仕様を読んだ
- [ ] doing/ に衝突しそうなタスクがないか確認した
- [ ] 類似の既存実装を特定した

**上記が完了していない場合、タスク分配に進まないでください。**

---

## 1. 前提情報（オーケストレーターへ）

あなたは複数のAIエージェントに並列でタスクを割り振るオーケストレーターです。

**重要**: セクション0のコンテキスト取得が完了していることを前提とします。

### 1.1 このプロジェクトの構造

```
specs/
├── overview.md           # ★システム全体像（全エージェント必読）
├── features/             # 機能別仕様
│   ├── diary.md
│   ├── chat.md
│   ├── survey.md
│   ├── notification.md
│   ├── tutorial.md
│   ├── archive.md
│   └── mentor.md
└── shared/               # 共通仕様
    ├── conventions.md    # コーディング規約
    ├── colors.md
    ├── typography.md
    └── components.md

project/
├── backlog/
│   ├── todo/             # 未着手タスク
│   ├── doing/            # 進行中タスク
│   └── done/             # 完了タスク
└── decisions/            # 技術的意思決定

frontend/src/
├── components/           # UIコンポーネント
├── pages/                # ページ
├── hooks/                # カスタムフック
├── types/                # 型定義
├── mockData/             # モックデータ
└── styles/               # スタイル
```

### 1.2 エージェントの特性（重要）

- **書いてある通りにしかやらない** → 暗黙の期待は通じない
- **他のエージェントの作業を知らない** → 依存関係を明示必須
- **コンテキストウィンドウに限りがある** → 必要最小限の情報を渡す
- **確認なしに実行する** → 禁止事項を明確に

---

## 2. タスク分配の手順

### Step 1: タスクの分解

ユーザーから受け取ったタスクを以下の観点で分解：

1. **独立して実行可能な単位**に分割
2. **依存関係**を特定（A→Bの順序が必要か）
3. **衝突の可能性**を特定（同じファイルを触るか）

### Step 2: 各タスクに必要な情報を特定

| 情報 | 例 |
|------|-----|
| 必読ファイル | specs/features/diary.md, specs/shared/conventions.md |
| 参考ファイル | 類似実装: components/chat/ChatMessage.tsx |
| 編集対象 | components/diary/DiaryPostCard.tsx |
| 触ってはいけない | pages/, mockData/ |

### Step 3: プロンプト生成

各エージェント用のプロンプトを生成。

---

## 3. エージェント用プロンプトのテンプレート

```markdown
# タスク: {タスク名}

## 0. 最初に必ず読むファイル（スキップ禁止）

以下のファイルを **必ず最初に読んでから** 作業を開始してください。
読まずに作業を始めることは禁止です。

1. `specs/overview.md` - システム全体像
2. `specs/features/{機能名}.md` - このタスクの仕様
3. `specs/shared/conventions.md` - コーディング規約
{追加の必読ファイルがあれば列挙}

## 1. タスク概要

{1-2文でタスクを説明}

## 2. 完了条件

以下をすべて満たすこと：

- [ ] {条件1}
- [ ] {条件2}
- [ ] {条件3}
- [ ] TypeScriptエラーがないこと
- [ ] 既存のスタイル規約に従っていること

## 3. 編集対象ファイル（これだけ触れる）

| ファイル | 操作 |
|----------|------|
| `{パス1}` | 新規作成 |
| `{パス2}` | 編集 |

**上記以外のファイルは編集禁止です。**

## 4. 参考にすべき既存実装

類似の実装パターンを確認してから作業してください：

- `{パス}` - {何の参考になるか}
- `{パス}` - {何の参考になるか}

## 5. 技術的制約

- ❌ `any` 型の使用禁止
- ❌ CSS値のハードコード禁止（CSS変数を使用）
- ❌ 外部ライブラリの追加禁止
- ✅ 型は `import type` で import
{タスク固有の制約があれば追加}

## 6. 他タスクとの関係

### 依存するタスク（先に完了している必要あり）
- {なし / タスクAが完了していること}

### 依存されるタスク（このタスク完了後に実行可能になる）
- {なし / タスクBがこのタスクを待っている}

### 衝突の可能性
- {なし / タスクCと同じファイルを触る可能性 → 注意}

## 7. 作業完了時の報告

作業完了時に以下を報告してください：

1. 作成/編集したファイル一覧
2. 主要な変更点の要約
3. 未解決の問題があれば
```

---

## 4. 分配時のチェックリスト

### 各プロンプトに含まれているか確認

- [ ] 必読ファイルが明示されている
- [ ] 「スキップ禁止」と明記されている
- [ ] 編集対象ファイルが限定されている
- [ ] 「上記以外は編集禁止」と明記されている
- [ ] 参考にすべき既存実装が示されている
- [ ] 技術的制約が列挙されている
- [ ] 完了条件が明確
- [ ] 他タスクとの依存関係が明記されている

### 並列実行の安全性確認

- [ ] 同じファイルを編集するタスクが同時に走らない
- [ ] 依存関係のあるタスクは順序が守られる
- [ ] 各タスクのスコープが重複していない

---

## 5. 使用例

### ユーザーの依頼

```
メンター管理機能を実装したい。
メンター一覧表示、メンター詳細表示、メンター追加フォームが必要。
```

### オーケストレーターの分解

| タスク | 依存 | 編集対象 |
|--------|------|----------|
| Task A: 型定義作成 | なし | types/mentor.ts |
| Task B: モックデータ作成 | A | mockData/mentors.ts |
| Task C: MentorCard作成 | A | components/mentor/MentorCard.tsx |
| Task D: MentorList作成 | A, C | components/mentor/MentorList.tsx |
| Task E: MentorForm作成 | A | components/mentor/MentorForm.tsx |
| Task F: MentorPage作成 | B, D, E | pages/MentorPage.tsx |

### 並列実行計画

```
Wave 1 (並列可能): Task A
Wave 2 (並列可能): Task B, C, E  （Aの完了後）
Wave 3 (並列可能): Task D        （Cの完了後）
Wave 4 (並列可能): Task F        （B, D, Eの完了後）
```

### 生成されるプロンプト例（Task C）

```markdown
# タスク: MentorCardコンポーネント作成

## 0. 最初に必ず読むファイル（スキップ禁止）

以下のファイルを **必ず最初に読んでから** 作業を開始してください。
読まずに作業を始めることは禁止です。

1. `specs/overview.md` - システム全体像
2. `specs/features/mentor.md` - メンター機能の仕様
3. `specs/shared/conventions.md` - コーディング規約
4. `specs/shared/components.md` - 共通コンポーネント仕様
5. `frontend/src/types/mentor.ts` - Mentor型定義（Task Aで作成済み）

## 1. タスク概要

メンター1人分の情報をカード形式で表示するコンポーネントを作成する。

## 2. 完了条件

以下をすべて満たすこと：

- [ ] MentorCardコンポーネントが作成されている
- [ ] Mentor型を使用している
- [ ] アバター、名前、専門分野、自己紹介が表示される
- [ ] CSS Modulesでスタイリングされている
- [ ] TypeScriptエラーがないこと
- [ ] 既存のCardコンポーネントのスタイルと統一感がある

## 3. 編集対象ファイル（これだけ触れる）

| ファイル | 操作 |
|----------|------|
| `frontend/src/components/mentor/MentorCard.tsx` | 新規作成 |
| `frontend/src/components/mentor/MentorCard.module.css` | 新規作成 |

**上記以外のファイルは編集禁止です。**

## 4. 参考にすべき既存実装

類似の実装パターンを確認してから作業してください：

- `frontend/src/components/diary/DiaryPostCard.tsx` - カードコンポーネントの実装パターン
- `frontend/src/components/common/Card.tsx` - 基本Cardコンポーネント

## 5. 技術的制約

- ❌ `any` 型の使用禁止
- ❌ CSS値のハードコード禁止（CSS変数を使用）
- ❌ 外部ライブラリの追加禁止
- ✅ 型は `import type` で import
- ✅ CSS Modulesを使用

## 6. 他タスクとの関係

### 依存するタスク（先に完了している必要あり）
- Task A: 型定義作成（types/mentor.ts）

### 依存されるタスク（このタスク完了後に実行可能になる）
- Task D: MentorList作成（このコンポーネントを使用する）

### 衝突の可能性
- なし

## 7. 作業完了時の報告

作業完了時に以下を報告してください：

1. 作成/編集したファイル一覧
2. 主要な変更点の要約
3. 未解決の問題があれば
```

---

## 6. 注意事項

### エージェントがスキップしがちなこと

| スキップされがち | 対策 |
|-----------------|------|
| 仕様の読み込み | 「スキップ禁止」と明記 + 最初のセクションに配置 |
| 既存実装の確認 | 「参考にすべき実装」を明示 |
| 型定義の確認 | 必読ファイルに含める |
| CSS変数の使用 | 禁止事項に明記 |
| import type の使用 | 制約に明記 |

### 並列実行で起きやすい問題

| 問題 | 対策 |
|------|------|
| 同じファイルの競合 | 編集対象を排他的に割り当て |
| 依存関係の無視 | Wave分けで順序を強制 |
| 一貫性のない実装 | 参考実装を明示 |
| 命名規則の不統一 | conventions.md参照を必須に |

---

## 7. オーケストレーターへの指示

### 7.1 タスク分配前の必須作業（再確認）

**セクション0を実行していない場合、ここで必ず実行してください。**

1. `specs/overview.md` を読み、以下を把握：
   - 対象ユーザー（小中学生）
   - 機能一覧と各機能の概要
   - 技術スタック（React 18, TypeScript, CSS Modules等）
   - 禁止事項（any型、外部ライブラリ等）

2. `specs/shared/conventions.md` を読み、以下を把握：
   - 命名規則（PascalCase, camelCase等）
   - ファイル構成
   - import順序

3. ユーザーが依頼したタスクに関連する `specs/features/*.md` を読む

4. `project/backlog/doing/` を確認し、衝突の可能性を排除

5. `frontend/src/components/` で類似実装を探し、パターンを把握

### 7.2 タスク分配の実行

ユーザーからタスクを受け取ったら：

1. **上記7.1が完了していることを確認**
2. **タスクを分解** して依存関係を特定
3. **Wave分け** して並列実行計画を作成
4. **各タスク用のプロンプトを生成**（上記テンプレートに従う）
5. **チェックリストで検証** して漏れがないか確認
6. ユーザーに **実行計画を提示**

### 7.3 プロンプト生成時の必須確認

各エージェント用プロンプトを生成する際：

- [ ] 必読ファイルに `specs/overview.md` が含まれている
- [ ] 必読ファイルに `specs/shared/conventions.md` が含まれている
- [ ] 必読ファイルに関連する `specs/features/*.md` が含まれている
- [ ] 参考実装として具体的なファイルパスを指定している
- [ ] 編集対象ファイルが他タスクと重複していない
- [ ] 禁止事項がプロジェクトの禁止事項と一致している

### 7.4 出力フォーマット

```markdown
## コンテキスト取得結果

### 読み込んだファイル
- specs/overview.md - 読了
- specs/shared/conventions.md - 読了
- specs/features/{関連機能}.md - 読了
- project/backlog/doing/ - 確認済み（衝突なし / 衝突あり: {詳細}）

### プロジェクトの制約（確認済み）
- 技術スタック: React 18, TypeScript Strict, Vite, CSS Modules
- 禁止事項: any型、React.FC、外部UIライブラリ、CSS値ハードコード等

### 参考にする既存実装
- {パス} - {何の参考になるか}

---

## 実行計画

### Wave 1（並列実行可能）
- Task A: {概要}
- Task B: {概要}

### Wave 2（Wave 1完了後に並列実行可能）
- Task C: {概要}（依存: A）
- Task D: {概要}（依存: B）

---

## 各エージェント用プロンプト

### Task A用プロンプト
{プロンプト本文}

### Task B用プロンプト
{プロンプト本文}

...
```
